<!DOCTYPE html>
<html lang="pt-BR">
<head>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="mtg_tools">
    <link rel="manifest" href="/mtg_tools/manifest.json">
    <title>MTG Ferramentas - Menu Principal</title>
    <link rel="stylesheet" href="/mtg_tools/styles/main_style.css">
</head>
<body>
    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="hidden">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        <div class="install-content">
            <p class="install-title">Instalar App</p>
            <p class="install-subtitle">Use como aplicativo</p>
        </div>
        <button id="installBtn">Instalar</button>
        <button id="dismissInstall">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>
    <div class="container">
        <header>
            <h1>Ferramentas MTG</h1>
            <h2>Suíte de Utilidades para Magic: The Gathering</h2>
        </header>
        
        <nav>
            <ul>
                <li><a href="/mtg_tools/Ferramentas_MTG.html" class="active">🏠 Menu Principal</a></li>
                <li><a href="/mtg_tools/Deck_Tracker_V3.html">📊 Deck Stats Tracker</a></li>
                <li><a href="/mtg_tools/Calculadora_MTG.html">🧮 Calculadora de Probabilidade</a></li>
                <li><a href="/mtg_tools/Mtgo_Results.html">🏆 MTGO Results</a></li>
            </ul>
        </nav>

        <main>
            <section>
                <h2>Selecione a ferramenta que você deseja utilizar:</h2>
                <ul>
                    <li><a href="/mtg_tools/Deck_Tracker_V3.html" class="btn btn-primary">📊 Deck Stats Tracker</a></li>
                    <li><a href="/mtg_tools/Calculadora_MTG.html" class="btn btn-primary">🧮 Calculadora Mtg</a></li>
                    <li><a href="/mtg_tools/Mtgo_Results.html" class="btn btn-primary">🏆 MTGO Results</a></li>
                </ul>
            </section>
        </main>

        <footer>
            Ferramentas desenvolvidas para a comunidade de Magic: The Gathering.
        </footer>
    </div>
    <script>
        // ============================================
        // PWA INSTALL PROMPT
        // ============================================
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissInstall');

        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/mtg_tools/service-worker.js')
                    .then(reg => console.log('Service Worker registrado:', reg.scope))
                    .catch(err => console.error('Erro ao registrar Service Worker:', err));
            });
        }

        // Detectar se é iOS/Safari
        function isIOS() {
            return /iPhone|iPad|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        function isInStandaloneMode() {
            return ('standalone' in window.navigator) && (window.navigator.standalone);
        }

        // Capturar evento de instalação (Chrome/Edge Android/Desktop)
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Verifica se já foi dispensado anteriormente
            if (!localStorage.getItem('installPromptDismissed')) {
                installPrompt.classList.remove('hidden');
            }
        });

        // Para iOS: Mostrar instruções se não estiver instalado
        if (isIOS() && !isInStandaloneMode()) {
            // Verifica se já foi dispensado
            if (!localStorage.getItem('installPromptDismissed')) {
                // Modifica o conteúdo para iOS
                const installContent = installPrompt.querySelector('.install-content');
                installContent.innerHTML = `
                    <p class="install-title">Instalar como App</p>
                    <p class="install-subtitle">Toque em <span style="font-size: 1.2em;">⎙</span> e depois "Adicionar à Tela Inicial"</p>
                `;
                
                // Remove o botão "Instalar" no iOS (não funciona)
                installBtn.style.display = 'none';
                
                // Mostra o prompt
                installPrompt.classList.remove('hidden');
            }
        }

        // Botão de instalar (apenas Android/Desktop)
        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`Usuário ${outcome === 'accepted' ? 'aceitou' : 'recusou'} a instalação`);
            
            deferredPrompt = null;
            installPrompt.classList.add('hidden');
            
            if (outcome === 'dismissed') {
                localStorage.setItem('installPromptDismissed', 'true');
            }
        });

        // Botão de dispensar
        dismissBtn.addEventListener('click', () => {
            installPrompt.classList.add('hidden');
            localStorage.setItem('installPromptDismissed', 'true');
        });

        // Esconder banner quando o app já está instalado
        window.addEventListener('appinstalled', () => {
            installPrompt.classList.add('hidden');
            localStorage.removeItem('installPromptDismissed');
            console.log('PWA instalado com sucesso!');
        });
    </script>
</body>
</html>
